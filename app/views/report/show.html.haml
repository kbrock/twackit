- javascript :visualization, 'http://www.google.com/jsapi'
- title "#{@report.twitter_username} / #{@report.title}"

%h2
  - twitter_profile_url = "http://twitter.com/#{@report.twitter_username}"

  = succeed '&#8217;s' do
    - if @report.picture_url.blank?
      = link_to @report.full_name, twitter_profile_url
    - else 
      = link_to image_tag(@report.picture_url, :alt => @report.picture_description) + @report.full_name, twitter_profile_url
  = @report.title
  Report

- if @report.tweets.any?

  #updated
    %p#updating.wait{ searching_indicator } Searching for updates&hellip;
    %p#updated_at{ updated_timestamp }
      Updated
      %span.when= smart_timestamp @report.tweets.last.status_at
    %p#refresh_prompt{ :style => 'display: none;' }
      %strong 
        = succeed '!' do
          Found
          %span.count
      = link_to 'Reload this page'
      to see 
      = succeed '.' do
        %span.pronoun
      
  %ul.tabs
    %li 
      %a Chart
      %a Calendar
      %a Table
      %a Stats

  #chart.report-container
    %h4 Timeline
    #timeline
      %p.wait Loading...

  #calendar.report-container
    %h4 Calendar
    - 2.downto(0) do |months_ago|
      = tweet_calendar(Date.today << months_ago)

  #stats.report-container
    %h4 Stats
    %dl
      %dt Low
      %dd= @report.stats[:min]

      %dt High
      %dd= @report.stats[:max]

      %dt Average
      %dd= @report.stats[:avg]

      %dt Change
      %dd
        = number_with_precision @report.stats[:amount_change], :precision => 2
        = surround '(', ')' do
          = number_to_percentage @report.stats[:percent_change], :precision => 2

  #raw-data.report-container
    %h4 Data Points
    #data_table
      %p.wait Loading...

- else
  %p 
    %strong No tweets found yet.
    Twackit searches for new tweets every hour.

:javascript
  var twitterer = #{@report.twitter_username.to_json};
  var hashtag = #{@report.hashtag.to_json};
  var backgroundSearch = #{@background_search.to_json};

  vizData = #{@report.visualization_data.to_json};  
  google.load('visualization', '1', {'packages':['annotatedtimeline', 'table']});
  google.setOnLoadCallback(initViz);

  